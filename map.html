<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Site Map with Google Maps</title>
  <style>
    body { margin: 0; font-family: sans-serif; }
    #map { width: 100%; height: 80vh; }
    #location-info {
      padding: 1rem;
      background: #f9f9f9;
      border-top: 1px solid #ddd;
    }
    .info-window {
      font-size: 14px;
      line-height: 1.4;
      max-width: 250px;
    }
    .info-window h3 {
      margin: 0 0 0.5em;
      font-size: 16px;
    }
    .info-window .status {
      color: #c00;
      font-weight: bold;
    }
    .info-window a {
      display: inline-block;
      margin-top: 0.5em;
      padding: 6px 12px;
      background: #1976d2;
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <div id="map"></div>
  <div id="location-info">กำลังค้นหาตำแหน่งของคุณ…</div>

  <!-- Google Maps JS API -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">
  </script>
  <script>
    // ข้อมูลไซต์ต่างๆ (ตัวอย่าง)
    const sites = [
      {
        lat: 13.736717, lng: 100.523186,
        siteName: 'สำนักงานใหญ่ กรุงเทพฯ',
        status: 'Comm Error',
        lastUpdated: '2025-07-17 11:19:43',
        link: 'https://example.com/site-detail/1'
      },
      {
        lat: 18.787747, lng: 98.993094,
        siteName: 'สาขา เชียงใหม่',
        status: 'Online',
        lastUpdated: '2025-07-17 09:05:12',
        link: 'https://example.com/site-detail/2'
      },
      // ... เพิ่มจุดอื่นๆ ได้ตามต้องการ
    ];

    let map, geocoder, userMarker;

    function initMap() {
      // เริ่มต้นแผนที่ที่ประเทศไทย
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 15.0, lng: 100.0 },
        zoom: 6
      });

      geocoder = new google.maps.Geocoder();

      // สร้าง marker และ InfoWindow สำหรับแต่ละไซต์
      sites.forEach(site => {
        const marker = new google.maps.Marker({
          position: { lat: site.lat, lng: site.lng },
          map,
          icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
        });

        const content = `
          <div class="info-window">
            <h3>${site.siteName}</h3>
            <div>Last updated: ${site.lastUpdated}</div>
            <div>Status: <span class="status">${site.status}</span></div>
            <a href="${site.link}" target="_blank">ข้อมูลเพิ่มเติม</a>
          </div>
        `;

        const infoWindow = new google.maps.InfoWindow({ content });

        marker.addListener('click', () => {
          infoWindow.open(map, marker);
        });
      });

      // ขอสิทธิ์ค้นหาตำแหน่งผู้ใช้
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const userPos = {
            lat: pos.coords.latitude,
            lng: pos.coords.longitude
          };

          // ปักหมุดผู้ใช้ด้วยไอคอนสีน้ำเงิน
          userMarker = new google.maps.Marker({
            position: userPos,
            map,
            icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
          });

          // ปักศูนย์แผนที่ที่ตำแหน่งผู้ใช้ (ถ้าต้องการ)
          map.setCenter(userPos);
          map.setZoom(8);

          // แปลงพิกัดเป็นชื่อที่อยู่ (จังหวัด)
          geocoder.geocode({ location: userPos }, (results, status) => {
            if (status === 'OK' && results[0]) {
              const comp = results[0].address_components;
              const province = comp.find(c =>
                c.types.includes('administrative_area_level_1')
              )?.long_name || 'ไม่ทราบจังหวัด';

              document.getElementById('location-info')
                .textContent = `คุณอยู่: ${province} (พิกัด: ${userPos.lat.toFixed(5)}, ${userPos.lng.toFixed(5)})`;
            } else {
              document.getElementById('location-info')
                .textContent = 'ไม่สามารถแปลงพิกัดเป็นที่อยู่ได้';
            }
          });
        }, err => {
          document.getElementById('location-info')
            .textContent = 'ไม่สามารถเข้าถึงตำแหน่งของคุณได้';
        });
      } else {
        document.getElementById('location-info')
          .textContent = 'Browser ไม่รองรับ Geolocation API';
      }
    }

    // เรียกฟังก์ชัน initMap หลังโหลด JS API
    window.initMap = initMap;
  </script>

</body>
</html>
