<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leonics</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col md:flex-row h-screen">

  <!-- Backdrop -->
  <div id="backdrop"
       class="hidden fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden"
       onclick="closeSidebar()"></div>

  <!-- Sidebar -->
  <aside id="sidebar"
         class="fixed top-0 left-0 h-full w-64 bg-gray-800 text-white flex-col p-4 z-40 transform -translate-x-full transition-transform duration-300 md:translate-x-0 md:static md:flex">

    <header class="mb-6">
      <h2 class="text-5xl font-bold mb-6">
        <a href="sitemap.html" target="content-frame" class="text-white hover:text-blue-300 transition-colors duration-200">MENU</a>
      </h2>
    </header>

    <nav aria-label="menu" class="flex-1 overflow-auto">
      <ul class="space-y-2" id="mainMenu">

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏î‡∏¥‡∏° -->
        <li>
          <a href="sitemap.html" target="content-frame"
             class="flex items-center w-full hover:bg-gray-700 p-2 rounded text-left font-bold text-white">
            <span class="mr-2">üó∫Ô∏è</span> Site Map
          </a>
        </li>
        <li>
          <a href="data_renew.html" target="content-frame"
             class="flex items-center w-full hover:bg-gray-700 p-2 rounded text-left font-bold text-white">
            <span class="mr-2">üìä</span> DATA
          </a>
        </li>

        <!-- ‡πÄ‡∏°‡∏ô‡∏π Region/Subregion/PEA Code -->
        <li>
          <div id="regionMenuContainer" class="mt-2"></div>
        </li>
      </ul>
    </nav>

    <div class="flex justify-between space-x-2 mt-4">
      <button id="adminBtn" class="bg-white px-3 py-2 rounded text-sm flex items-center gap-1 text-green-800 ">üë§ <span id="roleLabel">Loading...</span></button>
      <script>
        // ‡∏î‡∏∂‡∏á role ‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô API (‡πÄ‡∏ä‡πà‡∏ô user_role.php)
        fetch('user_role.php')
          .then(res => res.json())
          .then(data => {
        // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤ data = { role: "admin" }
        const role = data.role || 'unknown';
        document.getElementById('roleLabel').textContent = role.charAt(0).toUpperCase() + role.slice(1);
          })
          .catch(() => {
        document.getElementById('roleLabel').textContent = 'Unknown';
          });
      </script>
      <button class="bg-red-600 px-3 py-2 rounded text-sm flex items-center gap-1" onclick="logout()">üîí Lockout</button>
      <script>
        function logout() {
          // ‡∏•‡∏ö session ‡∏´‡∏£‡∏∑‡∏≠ token ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
          // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: localStorage.removeItem('token');
          // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login ‡πÅ‡∏•‡πâ‡∏ß replace history
          window.location.replace('index.html');
        }
      </script>
    </div>
  </aside>

  <!-- Mobile Toggle Button -->
  <button id="sidebarToggle"
          class="md:hidden fixed top-4 left-4 z-50 bg-gray-800 text-white p-2 rounded">
    ‚ò∞
  </button>

  <!-- Main content area -->
  <main class="flex-1 overflow-auto p-4">
    <iframe name="content-frame"
            src="sitemap.html?v=1"
            class="w-full h-[calc(100vh-2rem)] border-none"></iframe>
  </main>

  <!-- Script -->
  <script>
  fetch('peacode_structure.php')
.then(res => res.json())
.then(data => {
  const container = document.getElementById('regionMenuContainer');
  container.innerHTML = '';

  // ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏ä‡πà‡∏ô Central, North ‡∏ï‡∏≤‡∏° prefix ‡∏Ç‡∏≠‡∏á region_name
  const groupedData = {};

  for (const regionName in data) {
    // ‡∏´‡∏≤‡∏Ñ‡∏≥ prefix: ‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÄ‡∏ä‡πà‡∏ô Central1 -> Central
    const prefixMatch = regionName.match(/^[a-zA-Z]+/);
    const groupName = prefixMatch ? prefixMatch[0] : regionName;

    if (!groupedData[groupName]) {
      groupedData[groupName] = {};
    }

    // ‡πÉ‡∏™‡πà regionName (‡πÄ‡∏ä‡πà‡∏ô Central1) ‡∏•‡∏á‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡πâ‡∏ô
    groupedData[groupName][regionName] = data[regionName]; // data[regionName] ‡πÄ‡∏õ‡πá‡∏ô object ‡∏ó‡∏µ‡πà key ‡πÄ‡∏õ‡πá‡∏ô subregion
  }

  for (const groupName in groupedData) {
    const groupDiv = document.createElement('div');
    groupDiv.classList.add('mb-2');

    const groupBtn = document.createElement('button');
    groupBtn.className = 'flex items-center w-full hover:bg-gray-700 p-2 rounded text-left font-bold text-white';
    groupBtn.textContent = groupName;

    const groupArrow = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    groupArrow.setAttribute('class', 'ml-auto w-4 h-4 transform transition-transform');
    groupArrow.setAttribute('fill', 'none');
    groupArrow.setAttribute('stroke', 'currentColor');
    groupArrow.setAttribute('viewBox', '0 0 24 24');
    groupArrow.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />';
    groupBtn.appendChild(groupArrow);

    const regionUl = document.createElement('ul');
    regionUl.className = 'mt-1 ml-4 space-y-1 hidden';

    groupBtn.addEventListener('click', () => {
      regionUl.classList.toggle('hidden');
      groupArrow.classList.toggle('rotate-180');
    });

    // ‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á region (Central1, Central2, etc)
    for (const regionName in groupedData[groupName]) {
      const regionLi = document.createElement('li');

      const regionBtn = document.createElement('button');
      regionBtn.className = 'flex items-center w-full hover:bg-gray-700 p-2 rounded text-left text-sm text-blue-300 font-semibold';
      regionBtn.textContent = regionName;

      const regionArrow = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      regionArrow.setAttribute('class', 'ml-auto w-4 h-4 transform transition-transform');
      regionArrow.setAttribute('fill', 'none');
      regionArrow.setAttribute('stroke', 'currentColor');
      regionArrow.setAttribute('viewBox', '0 0 24 24');
      regionArrow.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />';
      regionBtn.appendChild(regionArrow);

      const subregionUl = document.createElement('ul');
      subregionUl.className = 'mt-1 ml-4 space-y-1 hidden';

      regionBtn.addEventListener('click', () => {
        subregionUl.classList.toggle('hidden');
        regionArrow.classList.toggle('rotate-180');
      });

      // ‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á subregion (Province)
      const subregions = groupedData[groupName][regionName]; // ‡πÄ‡∏õ‡πá‡∏ô object subregion => pea_code array
      for (const subregionName in subregions) {
        const subregionLi = document.createElement('li');

        const subregionBtn = document.createElement('button');
        subregionBtn.className = 'flex items-center w-full hover:bg-gray-700 p-2 rounded text-left text-sm text-green-300 font-medium';
        subregionBtn.textContent = subregionName;

        const subregionArrow = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        subregionArrow.setAttribute('class', 'ml-auto w-4 h-4 transform transition-transform');
        subregionArrow.setAttribute('fill', 'none');
        subregionArrow.setAttribute('stroke', 'currentColor');
        subregionArrow.setAttribute('viewBox', '0 0 24 24');
        subregionArrow.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />';
        subregionBtn.appendChild(subregionArrow);

        const peaCodeUl = document.createElement('ul');
        peaCodeUl.className = 'mt-1 ml-4 space-y-1 hidden';

        subregionBtn.addEventListener('click', () => {
          peaCodeUl.classList.toggle('hidden');
          subregionArrow.classList.toggle('rotate-180');
        });

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå pea code
        subregions[subregionName].forEach(pea => {
          const peaLi = document.createElement('li');
          const peaA = document.createElement('a');
          peaA.href = `data_renew.html?pea_code_id=${pea.pea_code_id}`;
          peaA.target = 'content-frame';
          peaA.textContent = pea.pea_code_name;
          peaA.className = 'block hover:bg-gray-700 p-2 rounded cursor-pointer text-sm text-gray-400 hover:text-white';

          peaLi.appendChild(peaA);
          peaCodeUl.appendChild(peaLi);
        });

        subregionLi.appendChild(subregionBtn);
        subregionLi.appendChild(peaCodeUl);
        subregionUl.appendChild(subregionLi);
      }

      regionLi.appendChild(regionBtn);
      regionLi.appendChild(subregionUl);
      regionUl.appendChild(regionLi);
    }

    groupDiv.appendChild(groupBtn);
    groupDiv.appendChild(regionUl);
    container.appendChild(groupDiv);
  }
})
.catch(e => console.error(e));


  const sidebar = document.getElementById('sidebar');
  const backdrop = document.getElementById('backdrop');
  const toggleBtn = document.getElementById('sidebarToggle');

  function openSidebar() {
    sidebar.classList.remove('-translate-x-full');
    backdrop.classList.remove('hidden');
  }

  function closeSidebar() {
    sidebar.classList.add('-translate-x-full');
    backdrop.classList.add('hidden');
  }

  toggleBtn.addEventListener('click', openSidebar);
  backdrop.addEventListener('click', closeSidebar);

  toggleBtn.addEventListener('click', () => {
    sidebar.classList.remove('-translate-x-full');
    backdrop.classList.remove('hidden');
    toggleBtn.classList.add('hidden'); // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°
  });

  function closeSidebar() {
    sidebar.classList.add('-translate-x-full');
    backdrop.classList.add('hidden');
    toggleBtn.classList.remove('hidden'); // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°
  }
</script>

</body>
</html>
